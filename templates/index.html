<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum SQL Optimizer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .query-box { width: 100%; height: 100px; margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .result-box { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .classical { background: #e9ecef; border-left: 4px solid #6c757d; }
        .quantum { background: #d4edda; border-left: 4px solid #28a745; }
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #007bff; }
        input:checked + .slider:before { transform: translateX(26px); }
        .loading { display: none; color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Quantum SQL Query Optimizer</h1>
        <p>Compare classical SQL execution vs quantum-optimized execution</p>
        
        <form id="queryForm">
            <label for="sqlQuery"><b>Enter SQL Query (3-table JOIN):</b></label><br>
            <textarea id="sqlQuery" class="query-box" placeholder="SELECT * FROM customers c JOIN orders o ON c.id = o.customer_id JOIN products p ON o.id = p.order_id WHERE c.city = 'New York'">
SELECT * FROM customers c JOIN orders o ON c.id = o.customer_id JOIN products p ON o.id = p.order_id
            </textarea><br>
            
            <button type="button" onclick="executeClassical()" class="btn">Execute Classical Query</button>
            
            <div style="margin: 20px 0;">
                <label class="toggle-switch">
                    <input type="checkbox" id="quantumToggle" onchange="toggleQuantum()">
                    <span class="slider"></span>
                </label>
                <span style="margin-left: 10px;"><b>Quantum Suggested Route Execution</b></span>
            </div>
            
            <button type="button" onclick="executeQuantum()" id="quantumBtn" class="btn" disabled>Execute Quantum-Optimized Query</button>
        </form>
        
        <div id="loading" class="loading">
            <h3>‚öõÔ∏è Quantum Computer is optimizing your query... This may take 1-2 minutes</h3>
            <div id="quantumProgress"></div>
        </div>
        
        <div id="results">
            <div id="classicalResult" class="result-box classical" style="display: none;">
                <h3>üèÅ Classical Execution Results</h3>
                <div id="classicalContent"></div>
            </div>
            
            <div id="quantumResult" class="result-box quantum" style="display: none;">
                <h3>üéØ Quantum Optimization Results</h3>
                <div id="quantumContent"></div>
            </div>
            
            <div id="comparison" style="display: none; margin-top: 30px;">
                <h3>üìä Performance Comparison</h3>
                <div id="chart"></div>
            </div>
        </div>
    </div>

    <script>
        let classicalTime = 0;
        let quantumTime = 0;
        let quantumRecommendation = null;
        
        function toggleQuantum() {
            const toggle = document.getElementById('quantumToggle');
            const quantumBtn = document.getElementById('quantumBtn');
            quantumBtn.disabled = !toggle.checked;
        }
        
        async function executeClassical() {
            const query = document.getElementById('sqlQuery').value;
            const resultDiv = document.getElementById('classicalResult');
            const contentDiv = document.getElementById('classicalContent');
            
            contentDiv.innerHTML = '<p>‚è≥ Executing query with classical optimizer...</p>';
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch('/execute-classical', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({query: query})
                });
                
                const data = await response.json();
                classicalTime = data.execution_time;
                
                contentDiv.innerHTML = `
                    <p><b>Execution Time:</b> ${classicalTime.toFixed(4)} seconds</p>
                    <p><b>Rows Returned:</b> ${data.row_count}</p>
                    <p><b>Join Order Used:</b> ${data.join_order || 'Classical Optimizer Choice'}</p>
                    <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <pre>${JSON.stringify(data.results, null, 2)}</pre>
                    </div>
                `;
                
            } catch (error) {
                contentDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        async function executeQuantum() {
            const query = document.getElementById('sqlQuery').value;
            const loadingDiv = document.getElementById('loading');
            const progressDiv = document.getElementById('quantumProgress');
            const resultDiv = document.getElementById('quantumResult');
            const contentDiv = document.getElementById('quantumContent');
            
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'block';
            
            // Simulate progress updates
            const stages = [
                "Connecting to IBM Quantum...",
                "Analyzing table statistics...", 
                "Formulating optimization problem...",
                "Running QAOA algorithm...",
                "Interpreting quantum results...",
                "Executing optimized query..."
            ];
            
            for (let i = 0; i < stages.length; i++) {
                progressDiv.innerHTML = `<p>${stages[i]}</p>`;
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            try {
                const response = await fetch('/execute-quantum', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({query: query})
                });
                
                const data = await response.json();
                quantumTime = data.execution_time;
                quantumRecommendation = data.quantum_recommendation;
                
                loadingDiv.style.display = 'none';
                
                contentDiv.innerHTML = `
                    <p><b>Execution Time:</b> ${quantumTime.toFixed(4)} seconds</p>
                    <p><b>Rows Returned:</b> ${data.row_count}</p>
                    <p><b>Quantum Recommended Join Order:</b> ${data.join_order}</p>
                    <p><b>Quantum Confidence:</b> ${(data.confidence * 100).toFixed(1)}%</p>
                    <p><b>Performance Improvement:</b> <span style="color: ${classicalTime > quantumTime ? 'green' : 'red'}">${((classicalTime - quantumTime) / classicalTime * 100).toFixed(1)}%</span></p>
                    <div style="background: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <pre>${JSON.stringify(data.quantum_analysis, null, 2)}</pre>
                    </div>
                `;
                
                showComparison();
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                contentDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        function showComparison() {
            const comparisonDiv = document.getElementById('comparison');
            const chartDiv = document.getElementById('chart');
            
            comparisonDiv.style.display = 'block';
            
            const data = [{
                x: ['Classical', 'Quantum'],
                y: [classicalTime, quantumTime],
                type: 'bar',
                marker: {
                    color: ['#6c757d', '#28a745']
                }
            }];
            
            const layout = {
                title: 'Execution Time Comparison',
                yaxis: {title: 'Time (seconds)'},
                showlegend: false
            };
            
            Plotly.newPlot('chart', data, layout);
        }
    </script>
</body>
</html>